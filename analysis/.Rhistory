# mutate(
#   ci_low  = pmax(0, prop_adult - 1.96 * se_adult),
#   ci_high = pmin(1, prop_adult + 1.96 * se_adult)
# ) %>%
rowwise() %>%
mutate(
p_value = binom.test(x, n, p = 0.5)$p.value
) %>%
ungroup() %>%
mutate(
prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2),
p_value = signif(p_value, 3)
)
dat_reach_hear
dat_jump_tired <- dat %>%
filter(trial_type == "asymmetric") %>%
unite("trial", c(option1_cause, option1_effect), sep = "_") %>%
filter(trial == "feel tired_jump up and down") %>%
drop_na(response) %>%
mutate(correct = response == adults) %>%
group_by(trial) %>%
summarize(
n = n(),
x = sum(correct),
prop_adult = x / n,
se_adult = sqrt(prop_adult * (1 - prop_adult) / n),
.groups = "drop"
) %>%
# summarize(n = n(),
#           prop_adult = mean(correct),
#           se_adult = sqrt(prop_adult * (1 - prop_adult) / n ),
#           .groups = "drop") %>%
mutate(prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2)) %>%
mutate(
ci_low  = pmax(0, prop_adult - 1.96 * se_adult),
ci_high = pmin(1, prop_adult + 1.96 * se_adult)
) %>%
rowwise() %>%
mutate(
p_value = binom.test(x, n, p = 0.5)$p.value
) %>%
ungroup() %>%
mutate(
prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2),
p_value = signif(p_value, 3)
)
dat_jump_tired
#p-values
dat_items_ps_pvalues <- dat %>%
filter(trial_type == "psychosomatic") %>%
select(subject_id, fam_item1, response, adults) %>%
drop_na(response) %>%
mutate(correct = response == adults) %>%
group_by(fam_item1) %>%
summarize(
n = n(),
x = sum(correct),
prop_adult = x / n,
se_adult = sqrt(prop_adult * (1 - prop_adult) / n),
.groups = "drop"
) %>%
rowwise() %>%
mutate(
p_value = binom.test(x, n, p = 0.5)$p.value
) %>%
ungroup() %>%
mutate(
prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2),
p_value = signif(p_value, 3)
)
dat_items_ps_pvalues
#psychosomatic
dat_items_ps <- dat %>%
filter(trial_type == "psychosomatic") %>%
select(subject_id, fam_item1, response, adults) %>%
drop_na(response) %>%
mutate(correct = response == adults) %>%
group_by(fam_item1) %>%
summarize(n = n(),
prop_adult = mean(correct),
se_adult = sqrt(prop_adult * (1 - prop_adult) / n ),
.groups = "drop") %>%
mutate(prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2))
dat_items_ps
dat_cond
dat_items_ps_pvalues
d_model <- dat %>%
select(subject_id, response, adults) %>%
drop_na(response) %>%
mutate(correct = as.integer(response == adults))
model_proportion <- glmer(correct ~ 1 + (1|subject_id),
family = binomial(link = 'logit'), data = d_model)
## All effects
summary(model_proportion)
plogis(fixef(model_proportion)[1])
ci_logit <- confint(model_proportion,
parm = "(Intercept)",
method = "Wald")
plogis(ci_logit)
## All effects
summary(model_proportion)
plogis(fixef(model_proportion)[1])
plogis(ci_logit)
#for trial type difference
model_trial_type <- glmer(
correct ~ trial_type + (1 | subject_id),
family = binomial,
data = dat %>% filter(trial_type %in% c("asymmetric", "psychosomatic"))
)
summary(model_trial_type)
#comparing each trial type to chance
#Asymetric
model_asym <- glmer(
correct ~ 1 + (1 | subject_id),
family = binomial,
data = dat %>% filter(trial_type == "asymmetric")
)
summary(model_asym)
plogis(2.6804)
#Pyschosomatic (aka Physiological)
model_ps <- glmer(
correct ~ 1 + (1 | subject_id),
family = binomial,
data = dat %>% filter(trial_type == "psychosomatic")
)
summary(model_ps)
summary(model_trial_type)
dat_cond <- dat %>%
filter(trial_type %in% c("psychosomatic", "asymmetric")) %>%
mutate(trial_type = as.factor(trial_type)) %>%
drop_na(correct) %>%
group_by(trial_type) %>%
summarize(n = n(),
prop_correct = mean(correct),
se_correct = sqrt(prop_correct * (1 - prop_correct) / n)) %>%
mutate(
ci_low  = pmax(0, prop_correct - 1.96 * se_correct),
ci_high = pmin(1, prop_correct + 1.96 * se_correct)
)
dat_cond
dat_subject_cond
sd_val <- stats::sd(.x$prop_correct)
dat_cond <- dat_subject_cond %>%
group_by(trial_type) %>%
group_modify(~{
n_val  <- nrow(.x)
sd_val <- stats::sd(.x$prop_correct)
tibble(
n = n_val,
prop_correct = mean(.x$prop_correct),
se_correct = sd_val / sqrt(n_val)
)
}) %>%
mutate(
ci_low  = pmax(0, prop_correct - 1.96 * se_correct),
ci_high = pmin(1, prop_correct + 1.96 * se_correct)
)
dat_cond
summary(model_ps)
dat_hung_pain <- dat %>%
filter(trial_type == "psychosomatic") %>%
unite("trial", c(option1_cause, option1_effect), sep = "_") %>%
filter(trial == "see something_feel hungry") %>%
drop_na(response) %>%
mutate(correct = response == adults) %>%
group_by(trial) %>%
summarize(
n = n(),
x = sum(correct),
prop_adult = x / n,
se_adult = sqrt(prop_adult * (1 - prop_adult) / n),
.groups = "drop"
) %>%
# summarize(n = n(),
#           prop_adult = mean(correct),
#           se_adult = sqrt(prop_adult * (1 - prop_adult) / n ),
#           .groups = "drop") %>%
mutate(prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2)) %>%
mutate(
ci_low  = pmax(0, prop_adult - 1.96 * se_adult),
ci_high = pmin(1, prop_adult + 1.96 * se_adult)
) %>%
rowwise() %>%
mutate(
p_value = binom.test(x, n, p = 0.5)$p.value
) %>%
ungroup() %>%
mutate(
prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2),
p_value = signif(p_value, 3)
)
dat_hung_pain
dat_sick_tired <- dat %>%
filter(trial_type == "psychosomatic") %>%
unite("trial", c(option1_cause, option1_effect), sep = "_") %>%
filter(trial == "choose what to do_feel sick") %>%
drop_na(response) %>%
mutate(correct = response == adults) %>%
group_by(trial) %>%
summarize(
n = n(),
x = sum(correct),
prop_adult = x / n,
se_adult = sqrt(prop_adult * (1 - prop_adult) / n),
.groups = "drop"
) %>%
# summarize(n = n(),
#           prop_adult = mean(correct),
#           se_adult = sqrt(prop_adult * (1 - prop_adult) / n ),
#           .groups = "drop") %>%
# mutate(prop_adult = round(prop_adult, 2),
#        se_adult = round(se_adult, 2)) %>%
mutate(
ci_low  = pmax(0, prop_adult - 1.96 * se_adult),
ci_high = pmin(1, prop_adult + 1.96 * se_adult)
) %>%
rowwise() %>%
mutate(
p_value = binom.test(x, n, p = 0.5)$p.value
) %>%
ungroup() %>%
mutate(
prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2),
p_value = signif(p_value, 3)
)
dat_sick_tired
dat_scared_pain <- dat %>%
filter(trial_type == "psychosomatic") %>%
unite("trial", c(option1_cause, option1_effect), sep = "_") %>%
filter(trial == "hear something_feel scared") %>%
drop_na(response) %>%
mutate(correct = response == adults) %>%
group_by(trial) %>%
summarize(
n = n(),
x = sum(correct),
prop_adult = x / n,
se_adult = sqrt(prop_adult * (1 - prop_adult) / n),
.groups = "drop"
) %>%
# summarize(n = n(),
#           prop_adult = mean(correct),
#           se_adult = sqrt(prop_adult * (1 - prop_adult) / n ),
#           .groups = "drop") %>%
mutate(prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2)) %>%
mutate(
ci_low  = pmax(0, prop_adult - 1.96 * se_adult),
ci_high = pmin(1, prop_adult + 1.96 * se_adult)
) %>%
rowwise() %>%
mutate(
p_value = binom.test(x, n, p = 0.5)$p.value
) %>%
ungroup() %>%
mutate(
prop_adult = round(prop_adult, 2),
se_adult = round(se_adult, 2),
p_value = signif(p_value, 3)
)
dat_scared_pain
dat_subject_cond_age <- dat %>%
filter(trial_type %in% c("psychosomatic", "asymmetric")) %>%
mutate(trial_type = ifelse(trial_type == "psychosomatic", "Physiological", "Asymmetric"),
trial_type = as.factor(trial_type)) %>%
drop_na(correct, age_floor, subject_id) %>%
group_by(trial_type, age_floor, subject_id) %>%
dplyr::summarize(
prop_correct = mean(correct),
.groups = "drop"
)
dat_cond_age <- dat_subject_cond_age %>%
group_by(trial_type, age_floor) %>%
group_modify(~{
n_val  <- nrow(.x)                 # number of subjects in this bin
sd_val <- stats::sd(.x$prop_correct)
tibble(
n = n_val,
prop_correct = mean(.x$prop_correct),
se_correct = sd_val / sqrt(n_val)
)
}) %>%
ungroup()
dat_cond_age <- dat_cond_age %>%
mutate(se_correct = ifelse(is.na(se_correct), 0, se_correct))
fig_cond_age_raw <- ggplot() +
geom_col(
data = dat_cond_age,
aes(x = age_floor, y = prop_correct),
fill = "white",
color = "black"
) +
geom_errorbar(
data = dat_cond_age,
aes(x = age_floor,
ymin = prop_correct - se_correct,
ymax = prop_correct + se_correct),
width = .3
) +
geom_jitter(
data = dat_subject_cond_age,
aes(x = age_floor, y = prop_correct),
width = 0.12, height = 0, alpha = 0.6, size = 2
) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
coord_cartesian(ylim = c(0, 1)) +
scale_x_continuous(breaks = seq(0, 8, by = 1)) +
labs(y = "Proportion Adult-like", x = "Age") +
facet_wrap(~trial_type) +
theme_cowplot() +
theme(
axis.text.x = element_text(size = 25),
axis.title.x = element_text(size = 25),
axis.text.y = element_text(size = 25),
axis.title.y = element_text(size = 25),
strip.text = element_text(size = 22)
)
fig_cond_age_raw
ggsave(here("figures", "cond_age_raw.pdf"),
fig_cond_age_raw,
width = 6,
height = 5,
unit = "in",
bg = "white")
fig_cond_raw
fig_cond_raw <- ggplot() +
geom_col(
data = dat_cond,
aes(x = trial_type, y = prop_correct),
color = "black",
fill = "white"
) +
geom_errorbar(
data = dat_cond,
aes(
x = trial_type,
ymin = prop_correct - se_correct,
ymax = prop_correct + se_correct
),
width = 0.3
) +
geom_jitter(
data = dat_subject_cond,
aes(x = trial_type, y = prop_correct),
width = 0.12,
height = 0,
alpha = 0.6,
size = 2
) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
coord_cartesian(ylim = c(0, 1)) +
labs(
y = "Proportion Adult-like",
x = "Trial Type"
) +
scale_x_discrete(labels = c(
"asymmetric" = "Asymmetric",
"psychosomatic" = "Physiological"
)) +
theme_cowplot() +
theme(
axis.text.x  = element_text(size = 25),
axis.title.x = element_text(size = 25),
axis.text.y  = element_text(size = 25),
axis.title.y = element_text(size = 25)
)
fig_cond_raw
ggsave(here("figures", "cond_raw.pdf"),
fig_cond_raw,
width = 6,
height = 5,
units = "in",
bg = "white")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(jsonlite)
library(purrr)
library(tidyr)
library(tidyverse)
library(ggplot2)
library(rlang) # for %||%
library(here)
base_path <- here("data")
data_path <- paste0(base_path, "/dec-13/What-s-That-Sound-_all-responses-identifiable.json")
dat <- fromJSON(
data_path,
simplifyVector = FALSE
)
dat_extracted <- dat %>%
map_dfr(function(rec) {
#one-row tibble of record-level metadata
base_info <- tibble(
response_id        = rec$response$id           %||% NA,
response_uuid      = rec$response$uuid         %||% NA,
response_date      = rec$response$date_created %||% NA,
study_uuid         = rec$study$uuid            %||% NA,
participant_id     = rec$participant$hashed_id %||% NA,
child_id           = rec$child$hashed_id       %||% NA,
child_age_rounded  = rec$child$age_rounded     %||% NA,
child_gender       = rec$child$gender          %||% NA,
)
#safely extract exp_data
rec$exp_data %||% list() %>%
discard(~ length(.x) == 0) %>% #drop empty records
#iterate over frames
imap_dfr(function(frame, frame_name) {
frame_row <- tibble(
frame_name           = frame_name,
frameType            = frame$frameType            %||% NA_character_,
frameDuration        = frame$frameDuration        %||% NA_real_,
videoShown           = frame$videoShown           %||% NA_character_,
audioPlayed          = frame$audioPlayed %||% "" |> na_if(""),
selectedImage        = frame$selectedImage        %||% NA_character_,
correctImageSelected = frame$correctImageSelected %||% NA,
)
bind_cols(base_info, frame_row)
})
})
View(dat_extracted)
filter(response_id == "387434") %>%
separate(frame_name, c("frame_number", "frame_label"), sep = "-",
extra = "merge", convert = TRUE) %>%
arrange(frame_number) %>%
mutate(correct_answer = case_when(str_detect(videoShown, "-Blue") ~ "right",
str_detect(videoShown, "-Red") ~ "left",
TRUE ~ NA_character_
)) %>%
mutate(stimuli = str_extract(videoShown,
"(?<=/)[^/]+(?=\\.webm)")) %>%
fill(correct_answer, .direction = "down") %>%
mutate(correct_answer = ifelse(frame_name == "20-null", "right", correct_answer)) %>%
mutate(correct_answer = ifelse(frame_name %in% c("15-null", "16-null"),
"left", correct_answer)) %>%
mutate(correct_answer = case_when(!str_detect(frame_name, "null") ~ NA,
TRUE ~ correct_answer)) %>%
mutate(trial = case_when(str_detect(videoShown, "1-fam") ~ "fam1",
str_detect(videoShown, "2-fam") ~ "fam2",
str_detect(videoShown, "3-fam") ~ "fam3",
str_detect(videoShown, "4-fam") ~ "fam4",
str_detect(frame_name, "21-null") ~ "test1",
str_detect(frame_name, "23-null") ~ "test2",
str_detect(frame_name, "25-null") ~ "test3",
str_detect(frame_name, "27-null") ~ "test4",
str_detect(frame_name, "29-null") ~ "test5",
str_detect(frame_name, "31-null") ~ "test6",
str_detect(frame_name, "33-null") ~ "test7",
str_detect(frame_name, "35-null") ~ "test8",
TRUE ~ NA_character_
)) %>%
fill(trial, .direction = "down") %>%
mutate(trial = ifelse(frame_name == "20-null", "fam5", trial)) %>%
mutate(trial = case_when(!str_detect(frame_name, "null") ~ "other",
TRUE ~ trial)) %>%
mutate(correct = selectedImage == correct_answer) %>%
mutate(stimuli = case_when(trial == "fam5" ~ "5-fam-Blue-duckMBallR_0000-0260",
TRUE ~ stimuli)) %>%
fill(stimuli, .direction = "down") %>%
mutate(stimuli = case_when(!str_detect(frame_name, "null") ~ "other",
TRUE ~ stimuli)) %>%
filter(!stimuli %in% c("13-test-Red-DuckRBallL_0000-0260", #filter bad ones
"12-test-Red-DuckLBallR_0000-0260"))
dat_extracted %>%
filter(response_id == "387434") %>%
separate(frame_name, c("frame_number", "frame_label"), sep = "-",
extra = "merge", convert = TRUE) %>%
arrange(frame_number) %>%
mutate(correct_answer = case_when(str_detect(videoShown, "-Blue") ~ "right",
str_detect(videoShown, "-Red") ~ "left",
TRUE ~ NA_character_
)) %>%
mutate(stimuli = str_extract(videoShown,
"(?<=/)[^/]+(?=\\.webm)")) %>%
fill(correct_answer, .direction = "down") %>%
mutate(correct_answer = ifelse(frame_name == "20-null", "right", correct_answer)) %>%
mutate(correct_answer = ifelse(frame_name %in% c("15-null", "16-null"),
"left", correct_answer)) %>%
mutate(correct_answer = case_when(!str_detect(frame_name, "null") ~ NA,
TRUE ~ correct_answer)) %>%
mutate(trial = case_when(str_detect(videoShown, "1-fam") ~ "fam1",
str_detect(videoShown, "2-fam") ~ "fam2",
str_detect(videoShown, "3-fam") ~ "fam3",
str_detect(videoShown, "4-fam") ~ "fam4",
str_detect(frame_name, "21-null") ~ "test1",
str_detect(frame_name, "23-null") ~ "test2",
str_detect(frame_name, "25-null") ~ "test3",
str_detect(frame_name, "27-null") ~ "test4",
str_detect(frame_name, "29-null") ~ "test5",
str_detect(frame_name, "31-null") ~ "test6",
str_detect(frame_name, "33-null") ~ "test7",
str_detect(frame_name, "35-null") ~ "test8",
TRUE ~ NA_character_
)) %>%
fill(trial, .direction = "down") %>%
mutate(trial = ifelse(frame_name == "20-null", "fam5", trial)) %>%
mutate(trial = case_when(!str_detect(frame_name, "null") ~ "other",
TRUE ~ trial)) %>%
mutate(correct = selectedImage == correct_answer) %>%
mutate(stimuli = case_when(trial == "fam5" ~ "5-fam-Blue-duckMBallR_0000-0260",
TRUE ~ stimuli)) %>%
fill(stimuli, .direction = "down") %>%
mutate(stimuli = case_when(!str_detect(frame_name, "null") ~ "other",
TRUE ~ stimuli)) %>%
filter(!stimuli %in% c("13-test-Red-DuckRBallL_0000-0260", #filter bad ones
"12-test-Red-DuckLBallR_0000-0260"))
